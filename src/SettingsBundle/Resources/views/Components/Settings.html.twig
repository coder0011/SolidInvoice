{% from "@SolidInvoiceSettings/macros.html.twig" import settings_section %}

<section class="row"{{ attributes }}>
    <aside class="col-3">
        <div class="card sticky-top">
            <div class="card-body">
                <ul class="nav nav-pills nav-sidebar flex-column sidebar-menu" role="tablist">
                    {% for settingsSection, setting in appSettings %}
                        <li class="nav-item">
                            <a href="{{ path('_settings', {section: settingsSection}) }}" class="nav-link{{ settingsSection is same as section ? ' active' }}">
                                {{ icon(settingIconMap[settingsSection]|default('cog')) }}
                                <p>{{ settingsSection|trans|title }}</p>
                            </a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </aside>

    <section class="col-9">
        {{ form_start(form, {
            attr: {
                'data-action': 'live#action:prevent',
                'data-live-action-param': 'prevent|files|save'
            }
        }) }}
        <div class="tab-content">
            <div class="card mb-3">
                <div class="card-header">
                    <h3 class="card-title">
                        {{ section|replace({"_" : " "})|title }}
                    </h3>
                </div>
                <div class="card-body">
                    {{ form_widget(form) }}
                </div>
            </div>
        </div>

        <div class="card-footer form-actions">
            <button type="submit" class="btn btn-success">{{ icon('save') }} {{ "settings.save"|trans }}</button>
        </div>
        {{ form_end(form) }}

        {% if section is same as('system') %}
            <hr />
            <div class="card mb-3 card-danger">
                <div class="card-header">
                    <h3 class="card-title">
                        {{ "Danger Zone"|trans }}
                    </h3>
                </div>
                <div class="card-body">
                    <p class="text-danger">
                        {{ "This section allows you to delete your company and all associated data."|trans }}
                    </p>
                    <p>
                        {{ "Please proceed with caution since this action cannot be undone."|trans }}
                    </p>
                    <div class="form-group"
                        {{ stimulus_controller('delete-company', {'company-name': company_name()}) }}
                    >
                        <button type="button"
                            class="btn btn-danger"
                            {{ stimulus_action('delete-company', 'showModal', 'click') }}
                        >
                            {{ icon('trash') }} {{ "Delete Company"|trans }}
                        </button>

                        <div class="modal fade"
                            id="deleteCompanyModal"
                            tabindex="-1"
                            role="dialog"
                            aria-labelledby="deleteCompanyModalLabel"
                            aria-hidden="true"
                            {{ stimulus_target('delete-company', 'modal') }}
                        >
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="deleteCompanyModalLabel">
                                            {{ "Confirm Company Deletion"|trans }}
                                        </h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="alert alert-danger">
                                            <strong>{{ "Warning!"|trans }}</strong>
                                            {{ "This action will permanently delete your company and all associated data. This cannot be undone."|trans }}
                                        </div>
                                        <p>
                                            {{ "To confirm deletion, please type the company name exactly as shown below:"|trans }}
                                        </p>
                                        <p class="fw-bold text-danger">{{ company_name() }}</p>
                                        <div class="form-group">
                                            <label for="companyNameConfirmation" class="form-label">
                                                {{ "Company Name"|trans }}
                                            </label>
                                            <input type="text"
                                               class="form-control"
                                               id="companyNameConfirmation"
                                               name="company_name"
                                               form="deleteCompanyForm"
                                               {{ stimulus_target('delete-company', 'companyNameInput') }}
                                               {{ stimulus_action('delete-company', 'validateInput', 'input') }}
                                               placeholder="{{ "Enter company name to confirm"|trans }}"
                                           >
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button"
                                            class="btn btn-secondary"
                                            data-dismiss="modal"
                                        >
                                            {{ "Cancel"|trans }}
                                        </button>

                                        <form id="deleteCompanyForm" action="{{ path('_delete_company') }}" method="post">
                                            <input type="hidden" name="_csrf_token" value="{{ csrf_token('delete_company') }}">

                                            <button type="submit"
                                                class="btn btn-danger"
                                                {{ stimulus_target('delete-company', 'confirmButton') }}
                                                disabled
                                            >
                                                {{ icon('trash') }} {{ "Delete Company"|trans }}
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </section>
</section>
